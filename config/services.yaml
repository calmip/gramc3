---

# Learn more about services, parameters and containers at
# https://symfony.com/doc/current/service_container.html
parameters:
    # parameter_name: value

    password_consoupload: MOTDEPASSE
    mailer_transport: smtp
    mailer_host: 127.0.0.1
    mailer_user: null
    mailer_password: null
    secret: ThisTokenIsNotSoSecretChangeIt
    mesoc: CALMIP
    mesoc_web: 'https://www.calmip.univ-toulouse.fr'
    mesoc_cgu: 'https://www.calmip.univ-toulouse.fr/cgu'
    mesoc_visu: 'https://www.calmip.univ-toulouse.fr/spip/spip.php?article463'
    mesoc_attrib: 'https://www.calmip.univ-toulouse.fr/spip/spip.php?article19'
    mesoc_merci: 'https://www.calmip.univ-toulouse.fr/spip/spip.php?article337'
    mesoc_address: 'CALMIP - Espace Clément Ader - 3 rue Caroline Aigle - 31400 TOULOUSE'
    attrib_seuil_a: 600000
    recup_attrib_seuil: 300000
    recup_conso_seuil: 30
    recup_attrib_quant: 50
    recup_printemps_d: 5
    recup_printemps_f: 8
    recup_automne_d: '09'
    recup_automne_f: 10
    conso_seuil_1: 70
    conso_seuil_2: 90
    max_fig_width: 800
    max_fig_height: 400
    max_page_nb: 5
    noconso: false
    max_rall: 4
    prj_prefix:
        1: P
        2: T

    ressources_conso_group:
        1:
            type: calcul
            ress: 'cpu,gpu'
            nom: 'Heures normalisées'
            unite: h
        2:
            type: stockage
            ress: work_space
            nom: 'Espace work'
            unite: Tio

    ressources_conso_user:
        1:
            type: calcul
            ress: 'cpu,gpu'
            nom: 'Heures normalisées'
            unite: h
        2:
            type: stockage
            ress: home_space
            nom: Home
            unite: Gio
        3:
            type: stockage
            ress: tmpdir_space
            nom: tmpdir
            unite: Gio
    max_expertises_nb: 1
    commentaires_experts_d: 5
    commentaires_experts_f: 3
    signature_directory: '%kernel.root_dir%/../data/fiches'
    rapport_directory: '%kernel.root_dir%/../data/rapports'
    fig_directory: '%kernel.root_dir%/../data/figures'
    dfct_directory: '%kernel.root_dir%/../data/dfct'
    heures_projet_test: 50000
    mailadmin: admin.calmip@univ-toulouse.fr
    mailfrom: ne-pas-repondre@calmip.univ-toulouse.fr
    old_journal: 5
    pwd_duree: P30D
    maildevt: devt1@exemple.com
    IDPprod:
        CNRS: 'https://janus.cnrs.fr/idp'
        'Université de Toulouse 3 Paul Sabatier': 'https://shibboleth.ups-tlse.fr/idp/shibboleth'
        'Comptes CRU': 'urn:mace:cru.fr:federation:sac'
        'INPT - Institut National Polytechnique de Toulouse': 'https://idp.inp-toulouse.fr/idp/shibboleth'
        AUTRE: WAYF

services:
    _defaults:
        public: true
        autowire: true
        autoconfigure: true
     
    # Tous les controleurs sont des services, ils peuvent utiliser la dependency injection
    App\Controller\:
        resource: '../src/Controller/*'
        tags: [controller.service_arguments]

    App\GramcServices\:
        resource: '../src/GramcServices/*'
        exclude: '../src/GramcServices/Workflow/*'

    app.gramc_user_provider:
        class: App\Security\User\GramcUserProvider

    app.user_checker:
        class: App\Security\User\UserChecker

    #    service_name:
    #        class: App\Directory\ClassName
    #        arguments: ["@another_service_name", "plain_value", "%parameter_name%"]
       
    # cf https://stackoverflow.com/questions/47613979/symfony-3-4-0-could-not-find-any-fixture-services-to-load
    # makes classes in src/AppBundle/DataFixtures available to be used as services
    # and have a tag that allows actions to type-hint services
    App\DataFixtures\:
        resource: '../src/DataFixtures'
        tags: ['doctrine.fixture.orm']

    App\EventListener\ExceptionListener:
        arguments: ["%kernel.debug%", "@router"]
        tags:
            - { name: kernel.event_listener, event: kernel.exception }

    # Evenements Doctrine lorsqu'on met à jour une version
    App\EventListener\VersionStamp:
        tags:
            - # these are the options required to define the entity listener
                name: 'doctrine.orm.entity_listener'
                event: 'preUpdate'
                entity: 'App\Entity\Version'

    App\EventListener\ProjetDerniereVersion:
        tags:
            - # these are the options required to define the entity listener
                name: 'doctrine.orm.entity_listener'
                event: 'postPersist'
                entity: 'App\Entity\Version'
            -   name: 'doctrine.orm.entity_listener'
                event: 'postRemove'
                entity: 'App\Entity\Version'
            -   name: 'doctrine.orm.entity_listener'
                event: 'postUpdate'
                entity: 'App\Entity\Version'

    # SERVICES GRAMC
    App\GramcServices\GramcDate:
        arguments: ["%recup_printemps_d%","%recup_printemps_f%",
                    "%recup_automne_d%",  "%recup_automne_f%"]

    App\GramcServices\DonneesFacturation:
        arguments: ['%dfct_directory%']

    App\GramcServices\GramcGraf\Calcul:
        arguments: ['ressources_conso_group','ressources_conso_user']
     
    App\GramcServices\GramcGraf\Stockage:
        arguments: ['ressources_conso_group','ressources_conso_user']

    App\GramcServices\GramcGraf\CalculTous:
        arguments: ['ressources_conso_group','ressources_conso_user']
     
    App\GramcServices\ServiceSessions:
        arguments: ['recup_attrib_seuil','recup_conso_seuil','recup_attrib_quant']
 
    App\GramcServices\ServiceProjets:
        arguments: ["%prj_prefix%",
                    "%ressources_conso_group%",
                    "%signature_directory%",
                    "%rapport_directory%",
                    "%fig_directory%",
                    "%dfct_directory%"]

    App\GramcServices\ServiceVersions:
        arguments: [ '%attrib_seuil_a%', "%prj_prefix%", "%fig_directory%", "%signature_directory%" ]
        
    App\GramcServices\ServiceMenus:
        arguments: [ "%max_rall%" ]
        
    App\GramcServices\ServiceNotifications:
        arguments: [ "%mailfrom%" ]

    App\GramcServices\ServiceExperts\ServiceExperts:
        arguments: [ "%max_expertises_nb%" ]

    App\GramcServices\ServiceExperts\ServiceExpertsRallonge:
        arguments: [ "%max_expertises_nb%" ]

    # Formulaires, validateurs
    App\Form\ThematiqueType:
        tags: ["form.type"]

    App\Form\MetaThematiqueType:
        tags: ["form.type"]

    App\Form\RattachementType:
        tags: ["form.type"]

    App\Validator\Constraints\PagesNumberValidator:
        arguments: [ "%max_page_nb%" ]
        tags: ["validator.constraint_validator" ]
        
    App\Form\PublicationType:
        tags: ["form.type"]

    App\Form\SessionType:
        tags: ["form.type"]

    # Workflows
    App\GramcServices\Workflow\Rallonge\RallongeWorkflow:
    
    App\GramcServices\Workflow\Version\VersionWorkflow:

    App\GramcServices\Workflow\Projet\ProjetWorkflow:

    App\GramcServices\Workflow\Session\SessionWorkflow:
    
