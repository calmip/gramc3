{% import "default/macros.html.twig" as gramcmacros %}

<div id="tab1" class="onglet">
	<br><br>
	<h2>Présentation générale</h2>

	<div class="presentation_generale">
		<div class="input">
			<div>
				<span>*
				</span> {{ form_label( form.prjTitre  ,"Titre du projet" ) }}
			</div> {{ form_widget( form.prjTitre  ,{ 'attr':{'size': '90','style' : ''}})}}
		</div>

		<div class="input"> {{ form_label( form.prjThematique, "Thématique principale du projet" ) }} {{ form_widget( form.prjThematique ) }}
		</div>

		<div class="input"> {{ form_label( form.prjSousThematique, "Sous-thématique (éventuellement)" ) }} {{ form_widget( form.prjSousThematique ) }}
		</div>

		{% if norattachement == false %}
			<div class="input"> {{ form_label( form.prjRattachement, "Rattachement du projet" ) }} {{ form_widget( form.prjRattachement ) }}
			</div>
		{% endif %}

        <div class="input">
        {{ form_label( form.demHeures, "Nombre d'heures demandées") }}
        {{ form_widget( form.demHeures) }}
        </div>
	</div>


		<div class="information ok">
			<h2>A savoir...</h2>
			<h3>Heures normalisées</h3>

			<ul>
				<li>Les heures que vous demandez seront utilisables indifféremment sur des noeuds CPU ou des noeuds avec GPU.</li>
				<li>Sur un nœud GPU:
					<ul>
						<li>Les heures utilisées seront converties en heures cpu avec un coefficient de conversion égal à 33 par GPU.</li>
						<li>Les heures CPU
							<strong>ne seront pas comptées</strong>
						</li>
					</ul>
				</li>
				<li>Si vous pensez utiliser les noeuds GPU
					<strong>vous devez prendre en compte ce coefficient de conversion</strong>.</li>
				<li>Votre demande d'heures totale intègre vos besoins en usage des noeuds CPU
					<strong>et vos besoins en usage des noeuds GPU</strong>.</li>
			</ul>

			<h4>Quelques exemples:</h4>
			<ul>
				<li>Un calcul utilisant
					<strong>1 cœur</strong>
					et
					<strong>1 GPU</strong>
					durant
					<strong>1 heure</strong>
					comptera
					<strong>33 heures</strong>
				</li>
				<li>Un calcul utilisant
					<strong>2 cœurs</strong>
					et
					<strong>2 GPUs</strong>
					durant
					<strong>1 heure</strong>
					comptera 2x33=<strong>66 heures</strong>
				</li>
				<li>Un calcul utilisant
					<strong>36 cœurs</strong>
					et
					<strong>4 GPUs</strong>
					durant
					<strong>1 heure</strong>
					comptera 4x33 =
					<strong>132 heures</strong>
				</li>
			</ul>

			<p>Plus de détails
				<a href="{{mesoc_web}}">
					<strong>sur notre site web</strong>
				</a>
			</p>

		{% if version.typeSession == 'B'  %}
				<h3>Session B</h3>
				<p>Les heures que vous allez demander viennent
					<strong>en supplément</strong>
					des heures que vous avez déjà reçues en session A (attribution initiale et rallonges).</p>
			</div>
		{% endif %}


	<h4>Laboratoire et responsable du projet :</h4>

	<table class="projet">
		<tbody>
			<tr>
				<th class="petite_col">Nom</th>
				<th>Mail</th>
				<th>Statut</th>
				<th>Laboratoire</th>
			</tr>
			<tr>
				<td>{{  version.responsable }}</td>
				<td>
					{% if( not version.responsable == null ) %} {{  version.responsable.mail }}
					{% endif %}
				</td>
				<td>
					{% if( not version.responsable == null ) %} {{  version.responsable.statut }}
					{% endif %}
				</td>
				<td>
					{% if( not version.responsable == null ) %} {{  version.responsable.labo }}
					{% endif %}
				</td>
			</tr>
		</tbody>
	</table>

	<p class="info_supplementaire">* Le laboratoire associé au projet est le laboratoire du responsable</p>

	<h4 id="collabs">Personnes participant au projet :</h4>
	<div class="information attention">
		<p><strong>Astuce :</strong>
		Commencez par l'adresse mail !</p></br>
		<p><strong>ATTENTION:</strong>
		Au moins un de vos collaborateurs doit avoir la case login cochée !</p>
	</div>

	<div id="liste_des_collaborateurs"> {{ form_widget(collaborateur_form) }}
	</div>

	{% if rapport_dactivite == true %}
		<div id="rapport_activite">
			<h4>Rapport d'activité de l'année précédente :</h4>
			{% if version.typeSession == 'B'  %}
				<div class="message info">Vous n'avez pas besoin de téléverser de rapport d'activité lors d'une session B.
					<br/>Nous vous le demanderons à la fin de l'année</div>
			{% elseif version.anneeRapport == 0 %}
				<div class="message info">Vous n'avez pas besoin de téléverser de rapport d'activité maintenant. Nous vous le demanderons à la fin de l'année</div>
			{% else %}
				<div id="uploadstatus"></div>
				<div id="fileuploader">
					<a href="{{ path('televerser_rapport_annee', { 'id' : version.idVersion, 'annee': version.anneerapport } ) }}" target="_blank">
						<strong>Téléversez le rapport d'activité</strong>
					</a>
				</div>
			{% endif %}
		</div>
	{% endif %}

	{% if version.versionPrecedente != null  %}
		<h4 id="prj_justif_renou">Justification du renouvellement :</h4>
		<table class="projet">
			<tbody>
				<tr>
					<th>Justification de votre demande de renouvellement (environ 2000 caractères)<br>
						<span id="form_prjJustifRenouv_cpt" class="petit"></span>
					</th>
				</tr>
				<tr>
					<td class="center">
						<p>
							<em>Justifiez votre demande de ressources par rapport à l'évolution de votre projet: Si la demande est importante (> 1Mh),
								         vous pouvez présenter un plan de calcul détaillé.<br/>
								Citez les codes utilisés (et n'oubliez pas, le cas échéant, de mettre à jour le champ de formulaire consacré
								         au code le plus utilisé)</em>
						</p> {{ form_widget(form.prjJustifRenouv,
                { 'attr': { 'class': 'compteur', 'rows' : 6, 'cols' : 70 } }) }}
						<div id="img_justif_renou_sts"></div>
						<div class="wrap-drop-zone">
							<div id="img_justif_renou_1" class="drop-zone" title="Faites glisser une image pour la téléverser">
								{% if  imageJust1 == null %}
									Figure 1
								{% else %}
									<img class="dropped" src="data:image/png;base64,{{ imageJust1 }}" alt="Figure 1"/>
									<img class="icone" src="{{ asset('icones/poubelle32.png') }}" alt="Supprimer cette figure" title="Supprimer cette figure">
								{% endif %}
							</div>
							<div id="img_justif_renou_2" class="drop-zone" title="Faites glisser une image pour la téléverser">
								{% if  imageJust2 == null %}
									Figure 2
								{% else %}
									<img class="dropped" src="data:image/png;base64,{{ imageJust2 }}" alt="Figure 2"/>
									<img class="icone" src="{{ asset('icones/poubelle32.png') }}" alt="Supprimer cette figure" title="Supprimer cette figure">
								{% endif %}
							</div>
							<div id="img_justif_renou_3" class="drop-zone" title="Faites glisser une image pour la téléverser">
								{% if  imageJust3 == null %}
									Figure 3
								{% else %}
									<img class="dropped" src="data:image/png;base64,{{ imageJust3 }}" alt="Figure 3"/>
									<img class="icone" src="{{ asset('icones/poubelle32.png') }}" alt="Supprimer cette figure" title="Supprimer cette figure">
								{% endif %}
							</div>
						</div>
						<hr class="retour"> {{ gramcmacros.info_televersement(img_justif_renou_1,img_justif_renou_2,img_justif_renou_3) }}

					</td>
				</tr>
			</tbody>
		</table>
	{% endif %}

	<h4>Autres informations :</h4>
	<div class="input">
		<label>Financement :</label>
		{{ form_widget(form.prjFinancement ,
		{ 'attr':
			{
			'size': '90',
			'style' : ''
				}
		}) }}
		<p class="info_supplementaire">Si ce projet bénéficie d'un financement, précisez la source et le montant.</p>
	</div>

	<h4>Ressources offertes par GENCI ces deux dernières années :</h4>
	<div class="genci">
		<div class="input">
			<label>Centre(s)</label>
			{{ form_widget(form.prjGenciCentre, { 'attr': { 'size': '80' } }) }}
		</div>

		<div class="input">
			<label>Machine(s)</label>
			{{ form_widget(form.prjGenciMachines, { 'attr': { 'size': '80' } }) }}
		</div>

		<div class="input">
			<label for="prj_genci_heures">Heures accordées</label>
			{{ form_widget(form.prjGenciHeures) }}
		</div>

		<div class="input">
			<label for="prj_genci_dari">N° de projet Dari le plus récent</label>
			{{ form_widget(form.prjGenciDari) }}
			<small>(exemple: A0070911xxx)</small>
		</div>
	</div>

	<div class="pas_genci">
		<label for="prj_genci_dari">...sinon cliquez ici !</label>
		<input class="invisible_if_no_js" type="submit" name="nogenci" id="nogenci" value="PAS DE GENCI" title="Je n'ai pas déposé de projet sur les centres nationaux"/>
	</div>


</div>
